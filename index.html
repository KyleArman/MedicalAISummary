<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Patient Summary</title>
    <!-- Local Bootstrap CSS -->
    <link href="bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f8f9fa;
        }
        .top-image {
            max-width: 150px;
            display: block;
            margin: 0 auto 20px auto;
        }
        .summary-container {
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .box {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f1f3f5;
        }
        .box h4 {
            margin-bottom: 15px;
        }
        .yes {
            color: blue;
            font-weight: bold;
        }
        .no {
            color: red;
            font-weight: bold;
        }
        .dr-box .col-5.text-end {
            text-align: left; 
        }
        .indicator {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            display: inline-block;
        }

        .dr-box .row {
            padding-left: 10px;
            padding-right: 10px;
        }

        .dr-box .col-3,
        .dr-box .col-4,
        .dr-box .col-2 {
            padding: 4px 10px;
        }
    </style>
</head>
<body>

<!-- Top Image -->
<img src="top_logo.png" class="top-image" alt="Patient QR Code">

<div class="summary-container">

    <!-- Top image inside div -->
    <div class="text-center mb-3">
        <img src="PKUMap.png" class="rounded-circle" width="100" alt="PKU Map">
    </div>

    <!-- "To Do" Box -->
    <div class="box">
        <h4>To Do</h4>
        <ul class="list-group">
            <li id="liBloodTest" class="list-group-item">Blood Test (Lab Sample) <span id="bloodTest" class="value"></span></li>
            <li id="liUrineTest" class="list-group-item">Urine Test (Lab Sample) <span id="urineTest" class="value"></span></li>
            <li id="liRbst" class="list-group-item">Rapid Blood Sugar Test (Lab Sample) <span id="rbst" class="value"></span></li>
            <li id="liXRay" class="list-group-item">X-Ray <span id="xRay" class="value"></span></li>
            <li class="list-group-item">See the Doctor</li>
            <li class="list-group-item">Collect Prescribed Medicine at the Pharmacy</li>
        </ul>
    </div>

    <!-- Collapsible Dr View -->
    <!-- Header Row -->
    <div class="row fw-bold mb-2 text-muted">
        <div class="col-3">Test</div>
        <div class="col-2 text-center">Indicator</div>
        <div class="col-4">Symptoms</div>
        <div class="col-3">Consent</div>
    </div>

    <!-- Blood Test -->
    <div class="row py-2 align-items-center">
        <div class="col-3">Blood Test</div>
        <div class="col-2 text-center">
            <span id="bloodIndicator" class="indicator"></span>
        </div>
        <div class="col-4" id="bloodSymptoms"></div>
        <div class="col-3" id="btConsent"></div>
    </div>

    <!-- Urine Test -->
    <div class="row py-2 align-items-center">
        <div class="col-3">Urine Test</div>
        <div class="col-2 text-center">
            <span id="urineIndicator" class="indicator"></span>
        </div>
        <div class="col-4" id="urineSymptoms"></div>
        <div class="col-3" id="utConsent"></div>
    </div>

    <!-- Rapid Blood Sugar Test -->
    <div class="row py-2 align-items-center">
        <div class="col-3">Rapid Blood Sugar Test</div>
        <div class="col-2 text-center">
            <span id="rbstIndicator" class="indicator"></span>
        </div>
        <div class="col-4" id="rbstSymptoms"></div>
        <div class="col-3" id="rbstConsent"></div>
    </div>

    <!-- X-Ray -->
    <div class="row py-2 align-items-center">
        <div class="col-3">X-Ray</div>
        <div class="col-2 text-center">
            <span id="xRayIndicator" class="indicator"></span>
        </div>
        <div class="col-4" id="xRaySymptoms"></div>
        <div class="col-3" id="xrConsent"></div>
    </div>


        <!-- GDrive Link at the bottom -->
        <div class="text-center mt-3">
            <a id="gDriveLink" href="#" target="_blank" class="btn btn-link">View Patient Virtual Card</a>
        </div>
    </div>


</div>


<!-- Local Bootstrap JS Bundle -->
<script src="bootstrap.bundle.min.js"></script>

<script>
    const params = new URLSearchParams(window.location.search);

    function yesNo(value) {
        return value === "1" ? "Yes" : "No";
    }

    // Toggle To Do visibility
    function toggleVisibility(paramKey, liId, spanId) {
        const value = params.get(paramKey);
        const li = document.getElementById(liId);
        const span = document.getElementById(spanId);

        if (value === "1") {
            li.style.display = "list-item";
        } else {
            li.style.display = "none";
        }
    }

    toggleVisibility("bloodTest", "liBloodTest", "bloodTest");
    toggleVisibility("urineTest", "liUrineTest", "urineTest");
    toggleVisibility("rapidBloodSugarTest", "liRbst", "rbst");
    toggleVisibility("xRay", "liXRay", "xRay");

    // Set Doctor View indicator and consent
    function buildSymptoms(symptomKeys) {
        const labels = {
            fever: "Fever",
            cough: "Cough",
            headache: "Headache",
            urinaryHesitancy: "Urinary Hesitancy",
            urinaryFrequency: "Urinary Frequency",
            amenorrhea: "Amenorrhea"
        };

        const found = symptomKeys
            .filter(k => params.get(k) == "1")
            .map(k => labels[k]);

        return found;
    }

    function updateDrView(testKey, consentKey, indicatorId, symptomsId, consentId, symptomKeys, forceBlueOnSymptom = false) {

        const testValue = params.get(testKey) == "1";
        const consentValue = params.get(consentKey) == "1";

        const indicator = document.getElementById(indicatorId);
        const symptomsEl = document.getElementById(symptomsId);
        const consentEl = document.getElementById(consentId);

        const symptoms = buildSymptoms(symptomKeys);
        const hasSymptom = symptoms.length > 0;

        // --- Symptoms display ---
        symptomsEl.textContent = hasSymptom ? symptoms.join(", ") : "No symptom";

        // --- Indicator logic ---
        let isBlue = testValue || (forceBlueOnSymptom && hasSymptom);

        indicator.style.backgroundColor = isBlue ? "blue" : "red";

        // --- Consent logic ---
        if (isBlue) {
            consentEl.textContent = consentValue ? "Consent" : "No Consent";
        } else {
            consentEl.textContent = hasSymptom ? "No Consent" : "-";
        }
    }

    updateDrView(
        "bloodTest",
        "btConsent",
        "bloodIndicator",
        "bloodSymptoms",
        "btConsent",
        ["fever"]
    );

    updateDrView(
        "urineTest",
        "utConsent",
        "urineIndicator",
        "urineSymptoms",
        "utConsent",
        ["urinaryHesitancy", "amenorrhea"],
        true
    );

    updateDrView(
        "rapidBloodSugarTest",
        "rbstConsent",
        "rbstIndicator",
        "rbstSymptoms",
        "rbstConsent",
        ["urinaryFrequency"],
        true
    );

    updateDrView(
        "xRay",
        "xrConsent",
        "xRayIndicator",
        "xRaySymptoms",
        "xrConsent",
        ["cough"]
    );
</script>

</body>
</html>
