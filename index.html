<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Patient Summary</title>
    <!-- Local Bootstrap CSS -->
    <link href="bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f8f9fa;
        }
        .top-image {
            max-width: 150px;
            display: block;
            margin: 0 auto 20px auto;
        }
        .summary-container {
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .box {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f1f3f5;
        }
        .box h4 {
            margin-bottom: 15px;
        }
        .yes {
            color: blue;
            font-weight: bold;
        }
        .no {
            color: red;
            font-weight: bold;
        }
        .dr-box .row {
            align-items: center;
        }
        .dr-box .col-5,
        .dr-box .col-2 {
            padding: 0 15px;  
        }

        .dr-box .col-5.text-end {
            text-align: left; 
        }
        .indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: gray;
        }
    </style>
</head>
<body>

<!-- Top Image -->
<img src="top_logo.png" class="top-image" alt="Patient QR Code">

<div class="summary-container">

    <!-- Top image inside div -->
    <div class="text-center mb-3">
        <img src="PKUMap.png" class="rounded-circle" width="100" alt="PKU Map">
    </div>

    <!-- "To Do" Box -->
    <div class="box">
        <h4>To Do</h4>
        <ul class="list-group">
            <li id="liBloodTest" class="list-group-item">Blood Test: <span id="bloodTest" class="value"></span></li>
            <li id="liUrineTest" class="list-group-item">Urine Test: <span id="urineTest" class="value"></span></li>
            <li id="liRbst" class="list-group-item">Rapid Blood Sugar Test: <span id="rbst" class="value"></span></li>
            <li id="liXRay" class="list-group-item">X-Ray: <span id="xRay" class="value"></span></li>
            <li class="list-group-item">See the Doctor</li>
            <li class="list-group-item">Collect Prescribed Medicine at the Pharmacy</li>
        </ul>
    </div>

    <!-- Collapsible Dr View -->
    <div class="box">
        <h4>
            <button class="btn btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#drView" aria-expanded="true" aria-controls="drView">
                Doctor View
            </button>
        </h4>
        <div class="collapse show" id="drView">
            <div class="dr-box">
                <!-- Blood Test -->
                <div class="row border-bottom py-2 align-items-center">
                    <div class="col-5">Blood Test</div>
                    <div class="col-2 text-center"><span id="bloodIndicator" class="indicator"></span></div>
                    <div class="col-5" id="btConsent"></div>
                </div>
                <!-- Urine Test -->
                <div class="row border-bottom py-2 align-items-center">
                    <div class="col-5">Urine Test</div>
                    <div class="col-2 text-center"><span id="urineIndicator" class="indicator"></span></div>
                    <div class="col-5" id="utConsent"></div>
                </div>
                <!-- Rapid Blood Sugar Test -->
                <div class="row border-bottom py-2 align-items-center">
                    <div class="col-5">Rapid Blood Sugar Test</div>
                    <div class="col-2 text-center"><span id="rbstIndicator" class="indicator"></span></div>
                    <div class="col-5" id="rbstConsent"></div>
                </div>
                <!-- X-Ray -->
                <div class="row border-bottom py-2 align-items-center">
                    <div class="col-5">X-Ray</div>
                    <div class="col-2 text-center"><span id="xRayIndicator" class="indicator"></span></div>
                    <div class="col-5" id="xrConsent"></div>
                </div>
            </div>
        </div>

        <!-- GDrive Link at the bottom -->
    <div class="text-center mt-3">
        <a id="gDriveLink" href="#" target="_blank" class="btn btn-link">View Patient Virtual Card</a>
    </div>

</div>


<!-- Local Bootstrap JS Bundle -->
<script src="bootstrap.bundle.min.js"></script>

<script>
    const params = new URLSearchParams(window.location.search);

    function yesNo(value) {
        return value === "1" ? "Yes" : "No";
    }

    // Toggle To Do visibility
    function toggleVisibility(paramKey, liId, spanId) {
        const value = params.get(paramKey);
        const li = document.getElementById(liId);
        const span = document.getElementById(spanId);

        if (value === "1") {
            li.style.display = "list-item";
            span.textContent = yesNo(value);
        } else {
            li.style.display = "none";
        }
    }

    toggleVisibility("bloodTest", "liBloodTest", "bloodTest");
    toggleVisibility("urineTest", "liUrineTest", "urineTest");
    toggleVisibility("rapidBloodSugarTest", "liRbst", "rbst");
    toggleVisibility("xRay", "liXRay", "xRay");

    // Set Doctor View indicator and consent
    function updateDrView(testKey, consentKey, indicatorId, displayId) {
    const testValue = params.get(testKey);       // "1" if symptom/test present, "0" if not
    const consentValue = params.get(consentKey); // "1" if consent given, "0" if not

    const indicator = document.getElementById(indicatorId);
    const displaySpan = document.getElementById(displayId);

    if (testValue === "1") {
        // Test/symptom present
        indicator.style.backgroundColor = "blue"; // true = blue
        if (consentValue === "1") {
            displaySpan.textContent = "Consent";
        } else {
            displaySpan.textContent = "No Consent";
        }
    } else {
        // Test/symptom not present
        indicator.style.backgroundColor = "red";  // false = red
        displaySpan.textContent = "No Symptom";
    }
}

    // Apply to each test
    updateDrView("bloodTest", "btConsent", "bloodIndicator", "btConsent");
    updateDrView("urineTest", "utConsent", "urineIndicator", "utConsent");
    updateDrView("rapidBloodSugarTest", "rbstConsent", "rbstIndicator", "rbstConsent");
    updateDrView("xRay", "xrConsent", "xRayIndicator", "xrConsent");
</script>

</body>
</html>
